# 變更日誌 (Changelog)

本檔案記錄此專案自建立以來的所有重要變更。

---

## [2025-12-31]

### 優化/變更 (Changed)
- **語言偵測邏輯大幅改進**: `auto-fix-service.ts` 的 `isEnglishText()` 函數優化，現在只要標題有 **3 個以上中文字符**，就判定為中文標題，避免誤判包含技術英文詞彙的中文標題（如 "Claude Code 獲得原生 LSP 支援"）。
- **週報生成器雙語支援**: `trends-generator.ts` 新增 `title_en`、`core_message_en`、`persona_advice_en` 欄位，週報 `/weekly` 頁面現在同時產生中英文內容，無需事後翻譯。
- **Markdown 預覽清理**: `markdown.ts` 的 `preprocessMarkdown()` 新增移除 `**` 和 `__` 符號的邏輯，確保新聞列表預覽顯示乾淨的純文字。

### 修復 (Fixed)
- **雙語內容批次修復**: 執行全面審計與修復，翻譯了 17 則中文版英文標題與 15 則英文版中文標題，確保雙語版網站內容一致。
- **週報英文內容補齊**: 補翻現有週報的英文欄位（Title、Core Message、Persona Advice），解決 `/weekly` 頁面英文模式顯示中文的問題。

---

## [2025-12-29]

### 優化/變更 (Changed)
- **雙語內容一致性強化**: `auto-fix-service.ts` 引入更嚴格的語言檢測邏輯（區分純英文 vs 含術語的中文），並新增 `summary_zh` (確保不含英文) 與 `summary_en` (確保不含中文) 的雙向檢查。
- **新聞詳情頁 UI 升級**: 引入 Glassmorphism (玻璃擬態) 設計，使用 `backdrop-filter: blur(16px)` 與半透明背景提升閱讀體驗。

### 修復 (Fixed)
- **批次修復雙語內容**: 執行一次性腳本修復了 17 則中文版內容異常（英文標題/摘要）與 29 則英文版內容缺失的問題。

---

## [2025-12-28]

### 優化/變更 (Changed)
- **每日自動修復增強**: 將 daily cron 的雙語自動修復範圍從 7 天擴展至 **14 天**，每次處理量從 20 則增加至 **50 則**，確保中文版全部是中文標題、英文版全部有英文標題。

### 修復 (Fixed)
- **批次翻譯 205 則新聞**: 修復過去 14 天內 205 則仍為英文標題的新聞，全部翻譯成繁體中文並生成結構化摘要。

---

## [2025-12-26]

### 新增 (Added)
- **週報頁面 i18n 完整支援**: 週報 `/weekly` 頁面現在完整支援英文，包含風險摘要標題、核心訊息、角色建議等區塊；新增資料庫遷移腳本 `20251225_weekly_trends_i18n.sql` 添加英文欄位。
- **週報翻譯腳本**: 新增 `scripts/translate_weekly_trends.ts`，可批次翻譯現有週報內容至英文。

### 優化/變更 (Changed)
- **訂閱文案強化 FOMO 導向**: 
  - 主標語改為「這 3 則 AI 新聞，半年後你會後悔沒看到」(zh) / 「These 3 AI news stories? You'll regret missing them in 6 months」(en)
  - 按鈕文字改為「🚨 把明天的風險寄給我」，強調緊迫感
  - 成功訊息改為「✅ 完成！明早 8 點收信」，明確預期
- **X 貼文模板增強**: 新增 8 個中文 + 8 個英文 FOMO 鉤子短語（如「你老闆可能明天會問你這件事」、「The rules are changing. Are you ready?」）
- **LinkedIn 貼文模板增強**: 強化企業風險導向，新增「⚠️ 企業主/決策者該擔心什麼？」區塊，支援中英雙語輸出

### 修復 (Fixed)
- **週報英文內容缺失**: 修復 `/weekly` 頁面在英文模式下仍顯示中文的問題，現在標題、核心訊息、角色建議都會根據語言設定正確切換。

---

## [2025-12-25]


### 優化/變更 (Changed)
- **每日自動修復升級為雙向檢查**: `auto-fix-service.ts` 重構，新增 `autoFixChineseContent`（英→中）和 `autoFixEnglishContent`（中→英）兩個函數，確保中文版全中文、英文版全英文。
- **必讀頁面分類名稱 i18n**: 新增 8 個分類的英文翻譯（如 AI Fundamentals、ChatGPT & Conversational AI 等），英文模式顯示英文分類名稱。

### 修復 (Fixed)
- **批次中文翻譯**: 修復 125 則缺少中文標題或摘要的新聞，自動翻譯成繁體中文。
- **批次英文翻譯**: 修復 12 則缺少英文標題的新聞，確保週報、月報、必讀頁面在英文模式下顯示完整英文內容。

---

## [2025-12-24]

### 新增 (Added)
- **月報頁面 `/monthly`**: 展示過去 30 天的 AI 趨勢統計，包含新聞總數、涵蓋週數、追蹤主題數、日均新聞等統計儀表板，以及按週分組的手風琴式新聞列表。
- **必讀頁面 `/essentials`**: AI 入門必讀精選頁面，自動將新聞分類為 8 大主題（AI 基礎入門、ChatGPT、影像生成、企業影響等），幫助新手快速了解 AI 領域。
- **比較頁面 `/compare`**: 程式化 SEO 頁面，自動生成「A vs B」比較分析（如 GPT-5 vs Gemini 3），顯示雙方新聞報導數量、近 30 天熱度、最新動態並列比較，支援中英雙語。
- **社群貼文模板系統**: 新增 `social-templates.ts` 模板生成器，支援 X 鉤子貼文、X Thread、LinkedIn 標準貼文、LinkedIn 長文等 4 種格式。
- **社群貼文複製介面**: 新聞詳情頁新增「社群貼文模板」區塊，一鍵複製各平台貼文，方便社群分享。
- **社群貼文預覽 API**: 新增 `/api/social-preview` API，可查詢任意新聞的多平台貼文預覽。
- **每日自動修復服務**: 新增 `auto-fix-service.ts`，每天自動檢查並修復缺少中文標題或摘要的新聞（英→中翻譯）。
- **批次英文翻譯腳本**: 新增 `scripts/translate_to_english.ts`，批次翻譯缺少英文版的新聞（中→英翻譯）。

### 優化/變更 (Changed)
- **訂閱文案風險導向**: 將訂閱相關文案從「免費註冊」改為「風險導向」，強調「避免錯過 AI 決策風險」以提升轉換率。
- **導覽列擴充**: 桌機版導覽從 4 個連結增加到 6 個，新增月報、必讀、比較入口。
- **X 貼文模板精簡**: 優化 X 貼文長度，確保在 280 字元限制內，標題自動截斷至 60 字元。
- **LinkedIn 貼文模板優化**: 清除 Markdown 語法（表格、分隔線等），只輸出純文字，避免社群平台顯示亂碼。
- **統一快取設定**: 週報、月報、必讀、比較頁面快取時間統一為 5 分鐘（原 1-24 小時），加速資料更新。

### 修復 (Fixed)
- **比較頁搜尋邏輯**: 改進搜尋支援連字號變體（GPT-5 同時匹配 gpt-5、gpt 5、gpt5）。
- **歷史連結遺失**: 修復導覽列連結順序，確保「歷史」在桌機版顯示。
- **過時模型版本號**: 統一更新 GPT-4 → GPT-5、Gemini → Gemini 3。
- **英文標題翻譯**: 批次修復 114 則缺少中文標題的新聞（自動翻譯成繁體中文）。
- **中文標題翻譯**: 批次翻譯 84 則缺少英文版的新聞（中→英翻譯），確保英文版網站內容完整。
- **比較頁面 i18n**: 修復比較頁面未翻譯成英文的問題，新增完整英文版支援。

---

## [2025-12-23]

### 新增 (Added)
- **週報頁面 `/weekly`**: 全新週報頁面，展示過去 7 天的 AI 新聞與決策風險分析，整合 `weekly_trends` 資料，支援中英雙語。
- **手機版漢堡選單**: 行動裝置導覽改為滑出式選單，包含趨勢、週報、歷史、收藏、教學等完整入口。
- **週報內容批次修復工具**: 新增 `scripts/fix_weekly_content.ts` 腳本，自動翻譯英文標題並生成結構化中文摘要。

### 修復 (Fixed)
- **漢堡選單關閉按鈕**: 修復選單關閉按鈕 (X) 無法點擊的問題，增加 `z-index` 與 `pointer-events` 確保可點擊。
- **週報趨勢時區問題**: 修正每週一趨勢分析未執行的問題，改用 `Asia/Taipei` 時區判斷星期，而非 UTC。
- **Favicon 設定修正**: 修復 Favicon 不顯示的問題，將錯誤的 `/favicon.ico` 路徑修正為實際存在的 `/icon-192.png` 與 `/icon-512.png`。
- **新聞詳情頁程式碼污染**: 刪除 `news-content.tsx` 中意外留下的程式碼註解 (`// ... (previous imports) // ...`)，解決新聞標題前顯示亂碼的問題。
- **週報新聞內容補全**: 批次修復過去 7 天 110+ 則新聞，將英文標題翻譯成繁體中文，並為缺少摘要的項目生成結構化摘要。

---

## [2025-12-22]

### 優化/變更 (Changed)
- **語言切換效能**: 移除 `LanguageToggle` 元件中的 `useTransition`，語言切換現在**瞬間生效**，不再等待批次翻譯 API 完成，大幅提升操作流暢度。

### 修復 (Fixed)
- **Header 導覽修復**: 修復首頁「我的收藏」連結無法點擊的問題，將 `next/link` 替換為原生 `<a>` 標籤，避免 Next.js 客戶端路由失效的邊界情況。
- **書籤卡片整卡點擊**: 重構 `BookmarkCard` 元件，使用 `Link` 包裹整個卡片區域，確保點擊任何位置都能正確導航至新聞詳情頁，同時保持刪除按鈕的獨立功能。

---

## [2025-12-21]

### 優化/變更 (Changed)
- **書籤卡片體驗**: 重構 `BookmarkCard` 點擊機制，改用程式化導航取代 Stretched Link，解決部分區域無法點擊的死角，並防止誤觸標籤或移除按鈕。
- **行動端 Header**: 優化 Header 響應式佈局，解決 iPhone SE 等小尺寸裝置上語言切換與搜尋按鈕溢出畫面的問題。
- **會話保持 (Session Persistence)**: 強化 Supabase Auth 設定，啟用 `persistSession` 並優化 Middleware 排除規則，確保 iOS PWA 模式下登入狀態不遺失。

### 修復 (Fixed)
- **收藏頁面在地化**: 修復 `/bookmarks` 頁面標題 (My Bookmarks / 我的收藏) 與空狀態提示未隨語言切換更新的問題。
- **翻譯遺失**: 補齊部分歷史新聞 (如 "Former Splunk Exec") 缺失的繁體中文標題與摘要。

## [2025-12-20]

### 新增 (Added)
- **會員系統 (User Authentication)**: 整合 Supabase Auth，支援 Google 與 Facebook 一鍵登入/註冊。
- **跨裝置收藏同步 (Cloud Bookmarks)**: 用戶登入後，收藏的新聞會自動同步至雲端資料庫，實現跨裝置無縫閱讀。
- **行動版註冊入口**: 針對手機介面優化，新增專屬的圓形人像圖示按鈕，方便行動用戶快速登入。

### 優化/變更 (Changed)
- **註冊引導優化**: 將 Header 按鈕文字由「Log In」改為更具邀請性的「Sign Up (免費註冊)」。
- **資料庫關聯**: 完善 `user_bookmarks` 資料表結構，建立與 `news_items` 的完整關聯 (Foreign Key) 與 RLS 安全策略。

### 修復 (Fixed)
- **SEO 標題修復**: 解決網站標題顯示為 "Untitled" 的問題，補齊 OpenGraph 與 Metadata 設定。
- **資料庫型別錯誤**: 修正收藏功能因 UUID 型別不匹配導致的寫入錯誤。

---

## [2025-12-19]

### 新增 (Added)
- **Vercel Analytics 整合**: 導入全站分析功能，即時追蹤訪客流量、來源與行為。
- **英文版結構化摘要**: 英文新聞摘要現在採用與中文版一致的專業格式：
- **骨架屏體驗 (Skeleton Screens)**: 全面導入骨架屏加載效果，優化翻譯與資料讀取時的視覺體驗。
- **全站健康檢查 (Health Check)**: 新增資料庫完整性與前端視覺巡檢工具，確保系統穩定運行。
  - 🧠 Plain English (白話解讀)
  - ⚠️ Why You Should Care (對你的影響)
  - ✅ No Action Needed (不需行動)
  - 💡 Key Takeaway (關鍵影響)
  - 📊 Opportunities / Challenges 表格
  - 🗣️ Water Cooler Talk (社交話題)
  - 👔 For Decision Makers (給決策者)

### 優化/變更 (Changed)
- **摘要生成優化**: 改進 LLM 摘要生成流程：
  - 新增 `fetchArticleContent` 函數，自動抓取原文網頁內容
  - LLM 現在根據完整文章內容生成摘要，大幅提升摘要品質與準確性
- **「趨勢」頁面更新日期**: 將更新日期從「每週日」改為「每週一」
- **Archive 頁面快取優化**: 將快取時間從 1 小時縮短至 5 分鐘

### 修復 (Fixed)
- **中文版摘要顯示**: 修正 `summary_zh` 缺失時無法正確 fallback 到英文摘要的問題
- **摘要缺失修復**: 修復特定新聞因 LLM 偶發性錯誤導致的摘要缺失問題，並建立自動化批量修復機制。
- **INP 效能優化**: 解決語言切換按鈕 (Language Toggle) 的 Interaction to Next Paint (INP) 高延遲問題，使用 React Transition API 確保 UI 響應流暢。
- **歷史新聞翻譯**: 重新生成所有 300+ 則歷史新聞的繁體中文標題與摘要

---

## [2025-12-18]

### 新增 (Added)
- **效能優化**: 首頁改用 ISR (增量靜態再生)，大幅降低資料庫負載
- **流量增長引擎**: 強化標籤頁面 SEO，新增 Canonical URL 與 Breadcrumb 結構化資料

### 修復 (Fixed)
- **新手指南連結失效**: 修正首頁置頂「新手指南」卡片無法點擊的問題

---

## [2025-12-17]

### 新增 (Added)
- **E2E 自動化測試**: 導入 Playwright 測試框架，覆蓋核心導航與多語言切換場景
- **嚴格英文模式**: 整合自動批次翻譯與 Skeleton Loading，杜絕中文後備內容
- **焦點模式頭條**: 首頁在焦點模式下正確顯示雙語標題

### 優化/變更 (Changed)
- **導航優化**: 將標籤連結改為標準 `<a>` 標籤，解決狀態殘留問題

### 修復 (Fixed)
- **翻譯缺失**: 補齊焦點模式下缺少的英文翻譯字串
- **Hydration Mismatch**: 修正日期與動態內容在伺服器/客戶端渲染不一致的問題

---

## [2025-12-16]

### 新增 (Added)
- **嚴格全英文模式**: 實作零中文 Fallback 的英文介面
- **批次背景翻譯**: Cron Job 抓取新聞時立即進行背景翻譯

### 優化/變更 (Changed)
- **全站介面翻譯**: Header、Footer、教學頁面、訂閱介面完全中英文化

---

## [2025-12-14]

### 新增 (Added)
- **短網址系統**: 實作 8 碼短連結 (如 `/news/AbCdEf12`)
- **SEO 結構化資料**: 新增 JSON-LD 支援 (WebSite, NewsArticle)

### 優化/變更 (Changed)
- **分享文字簡化**: X (Twitter) 分享文字更簡潔

---

## [2025-12-12]

### 新增 (Added)
- **PWA 支援**: 可加入手機主畫面，擁有原生 App icon
- **下拉更新**: 手機下拉即可觸發爬蟲並獲取最新新聞
- **無限捲動**: 滑動至底部自動載入歷史新聞
- **即時爬蟲觸發**: Pull-to-Refresh 時觸發 On-Demand Scraper

### 優化/變更 (Changed)
- **Archive 頁面**: 只顯示 24 小時前的歷史新聞
- **品牌更新**: Logo 更新為 Flow 波浪風格

---

## [2025-12-11]

### 新增 (Added)
- **雙語切換**: 新增英文/繁體中文語言切換功能
- **Markdown 表格渲染**: 支援 AI 摘要中的表格美化顯示
- **ChatBox Markdown**: AI 對話支援 Markdown 格式渲染

### 優化/變更 (Changed)
- **行動版優化**: Header、搜尋、切換按鈕針對手機優化佈局
- **時區統一**: 全站使用 Asia/Taipei 時區

### 修復 (Fixed)
- **Chat 按鈕點擊**: 修正建議按鈕無法點擊的問題

---

## [2025-12-10]

### 新增 (Added)
- **AI 導讀助手 (Chat)**: 每則新聞內建互動式 AI 聊天機器人
- **搜尋功能**: 全站關鍵字搜尋（標題與摘要）
- **趨勢儀表板**: `/trends` 頁面視覺化呈現 AI 關鍵字流行趨勢
- **新聞詳細頁**: 實作獨立新聞頁面與動態 OG 圖片
- **RSS Feed**: 提供標準 `/feed.xml` 訂閱源
- **社群自動發布**: 支援自動發布至 X (Twitter)
- **熱門新聞區塊**: 首頁新增 HotNewsSection 組件

### 優化/變更 (Changed)
- **爬蟲優化**: 
  - 新增 Hacker News、Reddit r/artificial、Ars Technica 來源
  - 新增 Google News RSS 爬蟲
  - 改用 RSS Feed 提升抓取穩定性
  - 平行請求優化，防止 Timeout
- **LLM Prompt 優化**: 新增利弊分析表格與關鍵影響摘要
- **分頁 API**: 實作新聞分頁與「載入更多」功能

### 修復 (Fixed)
- **SEO 完善**: 新增 sitemap、robots.txt、metadata

---

## [2025-12-09]

### 新增 (Added)
- **新聞標題翻譯**: 自動將英文標題翻譯為繁體中文
- **電子報簽名**: 加入 Coach 簽名與網站連結
- **Footer 致謝**: 加入開發者致謝資訊

### 優化/變更 (Changed)
- **UI 風格**: 實作 Glassmorphism 玻璃擬態設計
- **品牌更新**: 更新 Logo 設計（多次迭代至黑白風格）

---

## [2025-12-08]

### 新增 (Added)
- **深色模式**: 支援系統/淺色/深色三種主題切換
- **Cron Jobs 遷移**: 將排程任務遷移至 GitHub Actions

### 修復 (Fixed)
- **Tailwind 深色模式**: 修正 Tailwind v4 與 next-themes 的 class-based 設定

---

## [2025-12-07]

### 新增 (Added)
- **專案初始設定**: 完成基礎架構與電子報功能
- **品牌重塑**: 專案更名為 Smart Flow (智流)

---

## [2025-11-28]

### 新增 (Added)
- **專案建立**: 使用 Create Next App 初始化專案
